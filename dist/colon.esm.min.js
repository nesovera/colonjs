/*!
 * Colon.js v0.0.1
 * (c) 2018-2019 NesoVera (nesovera@gmail.com)
 * Released under the MIT License.
 */
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Colon=function(){function Colon(e){var t=this;if(void 0===e&&(e={}),this.parent=e.parent,this.props=e.props||{},this.scope="function"==typeof e.scope?e.scope():e.scope||{},this.loopScope=e.loopScope||[],this.directives=e.directives||{},this.components=Object.entries(e.components||{}).reduce((function(e,t){var r=t[0],n=t[1];return e[r.toLowerCase()]=n,e}),{}),e.template&&(this.el=e.el||document.createElement("template"),this.el.innerHTML=e.template),this.el=this.el||e.el,!this.el)return console.error("Colon.js root element is not found");e.recursive||(Object.entries(this.scope).forEach((function(e){var r=e[0],n=e[1];"function"==typeof n&&(t.scope[r]=n.bind(t))})),Object.entries(this.directives).forEach((function(e){var r=e[0],n=e[1];t.directives[r]=n.bind(t)}))),["created","beforeUpdate","updated","mounted","destroyed"].map((function(r){t[r]=(e[r]||function(){}).bind(t)})),window.__CJSSTYLE||(window.__CJSSTYLE=this.insertStyle("[__CJSHIDE]{ display:none !important }")),this.created();this.templateTree=function e(r,n){return"#text"===r.nodeName?r.textContent:{node:r,parent:n,type:r.nodeName.replace(/-/g,"").toLowerCase(),attrs:t.getNodeAttrs(r),children:t.getChildNodes(r).map((function(t){return e(t,r)})),events:[]}}(this.el,null),this.render(),this.mounted()}var _proto=Colon.prototype;return _proto.insertStyle=function(e){return t=document,(r=t.createElement("style")).innerHTML=e,t.head.appendChild(r),r;var t,r},_proto.isObject=function(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e},_proto.getContent=function(e){return"template"===e.nodeName.toLowerCase()&&e.content||e},_proto.getChildNodes=function(e){return Array.from(this.getContent(e).childNodes).filter((function(e){return!/^(SCRIPT|STYLE)$/.test(e.nodeName)}))},_proto.getNodeAttrs=function(e){return Array.from(e.attributes||[]).reduce((function(e,t){return e[t.nodeName]=t.nodeValue,e}),{})},_proto.nodeToArray=function(e){return"template"===e.nodeName.toLowerCase()?this.getChildNodes(e):[e]},_proto.attrExist=function(e,t){return t.filter((function(t){return Object.keys(e).indexOf(t)>=0})).length},_proto.setAttr=function(e,t,r){if("boolean"==typeof r&&!r||void 0===r)return e.removeAttribute(t);e.setAttribute(t,r)},_proto.run=function run($code,_temp){var _ref4=void 0===_temp?{}:_temp,_ref4$$multi=_ref4.$multi,$multi=void 0!==_ref4$$multi&&_ref4$$multi,$arguments=_ref4.$arguments,$event=_ref4.$event,$this=_ref4.$this,$scope=this.scope,$parent=this.parent,$props=this.props,$loopScope=this.loopScope,loopVars=$loopScope.map((function(e,t){var r=e.keyVar,n=e.keyValue,o=e.valVar;return(r?"var "+r+" = "+JSON.stringify(n)+";":"")+"var "+o+" = $loopScope["+t+"].arr.find(function(v){return v[0]==="+JSON.stringify(n)+"})[1];"})).join("");return eval(loopVars+($multi?$code:"("+$code+")"))},_proto.diffArray=function(e,t,r,n){r||(r=[]),n||(n=[]);for(var o=0;o<Math.max(r.length,n.length);o++){var i=this.diffNode(e,t,r[o],n[o]);i&&(n[o]=i)}return n},_proto.diffNode=function(e,t,r,n){var o=this;if(!r&&n)return this.getContent(e).insertBefore(n,t||null);if(r&&!n)return this.getContent(e).removeChild(r),null;if(r.nodeName!=n.nodeName)return this.getContent(e).replaceChild(n,r),n;if(r.nodeType===Node.TEXT_NODE&&n.nodeType===Node.TEXT_NODE)r.nodeValue!==n.nodeValue&&(r.nodeValue=n.nodeValue);else{var i=this.getNodeAttrs(r),s=this.getNodeAttrs(n);Object.keys(_extends({},i,{},s)).map((function(e){return o.diffAttr(r,e,i[e],s[e])})),this.diffArray(r,null,Array.from(r.childNodes),Array.from(n.childNodes))}return r},_proto.diffAttr=function(e,t,r,n){null===r&&(r=e.getAttribute(t)),":"!==t.charAt(0)&&r!==n&&this.setAttr(e,t,n)},_proto.addPlaceHolder=function(e,t){e.cloneNode||(e.placeHolder=this.getContent(e.parent).insertBefore(document.createComment("<"+t+">"),e.node),e.cloneNode=e.node.cloneNode(!0),this.getContent(e.parent).removeChild(e.node),e.children=e.node=null)},_proto.renderTreeNode=function(e){var t=this,r=e.node,n=e.parent,o=e.type,i=e.attrs,s=e.children;if(!this.attrExist(i,[":pre"]))if(this.components[o]){this.addPlaceHolder(e,o);var d=Object.entries(i).map((function(e){var r=e[0],n=e[1];return":"===r.charAt(0)?[r.slice(1),t.run(n)]:[r,n]})).reduce((function(e,t){var r=t[0],n=t[1];return e[r]=n,e}),{});d.children=e.cloneNode.cloneNode(!0);var l=new Colon(_extends({props:d,parent:this},this.components[o])).el;e.renderedChildren=this.diffArray(n,e.placeHolder,e.renderedChildren,l?this.nodeToArray(l):[])}else Object.entries(i).filter((function(e){var t=e[0];return/^[:@]/.test(t)})).forEach((function(s){var d=s[0],l=s[1];if(!t.attrExist(i,[":for",":if"])||/^:(for|if)$/.test(d)){var a=d.slice(1);if(r&&void 0!==r.getAttribute(d)&&r.removeAttribute(d),":for"===d){var c=l.match(/^\s*([^\s,]+)(?:\s*,\s*([^\s,]+))?\s+in\s+(.+)/).slice(1),p=c[0],u=c[1],f=c[2];t.addPlaceHolder(e,":for"),f=t.run(f)||[],Array.isArray(f)&&(f=f.map((function(e,t){return[t,e]}))),t.isObject(f)&&(f=Object.entries(f)),f=f.reduce((function(r,n,o,i){var s=n[0],d=e.cloneNode.cloneNode(!0);return new Colon({el:d,recursive:!0,parent:t.parent,props:t.props,scope:t.scope,directives:t.directives,components:t.components,loopScope:[].concat(t.loopScope,[{arr:i,keyVar:u,keyValue:s,valVar:p}])}),r.push.apply(r,t.nodeToArray(d)),r}),[]),e.renderedChildren=t.diffArray(n,e.placeHolder,e.renderedChildren,f)}else if(":if"===d){var h;t.addPlaceHolder(e,":if"),t.run(l)&&new Colon({el:h=e.cloneNode.cloneNode(!0),recursive:!0,parent:t.parent,props:t.props,scope:t.scope,directives:t.directives,components:t.components,loopScope:t.loopScope}),e.renderedChildren=t.diffArray(n,e.placeHolder,e.renderedChildren,h?t.nodeToArray(h):[])}else if(/^:(class|style)$/.test(d)){var v="class"===a,m=t.run(l)||"";Array.isArray(m)&&(m=m.join(v?" ":";")),t.isObject(m)&&(m=Object.entries(m).reduce((function(e,t){var r=t[0],n=t[1];return e+" "+(v?n?r:"":r+":"+n+";")}),"")),t.diffAttr(r,a,null,((i[a]||"")+(v?" ":";")+(m||"")).trim())}else if(/^@/.test(d)){if(e.events.indexOf(a)>=0)return;r.addEventListener(a,(function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];t.run(l,{$multi:!0,$arguments:n,$event:n[0],$this:r}),t.render()}),!1),e.events.push(a)}else if(":show"===d){var y=t.run(l);r[y?"removeAttribute":"setAttribute"]("__CJSHIDE",y)}else if("slot"===o&&":name"===d){var C=t.run(l);t.addPlaceHolder(e,"slot:"+C);var A=t.props.children.cloneNode(!0);new Colon({el:A,recursive:!0,parent:t,props:t.props,scope:t.scope,directives:t.directives,components:t.components,loopScope:t.loopScope}),e.renderedChildren=t.diffArray(n,e.placeHolder,e.renderedChildren,Array.from(A.querySelectorAll(C)))}else if(/^:(html|text|json)$/.test(d)){if(!r)return;var N=t.run(l);"json"===a&&(N=JSON.stringify(N,null,2)),null==N&&(N="");var _="html"===a?"innerHTML":"innerText";r[_]!==N&&(r[_]=N)}else if(d){if(Object.entries(t.directives).filter((function(e){var t=e[0],o=e[1];if(new RegExp(t).test(d))return o({$attr:d,$value:l,$this:r,$parentNode:n}),!0})).length)return;var $=t.run(l);/^:/.test(a)&&(a=a.slice(1)),t.diffAttr(r,a,null,$)}}})),this.attrExist(i,[":for",":if"])||s.filter((function(e){return"string"!=typeof e})).forEach(this.renderTreeNode.bind(this))},_proto.render=function(){this.beforeUpdate(),this.renderTreeNode(this.templateTree),this.updated()},Colon}();export default Colon;