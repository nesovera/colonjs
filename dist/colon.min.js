/*!
 * Colon.js v0.0.5
 * (c) 2018-2019 NesoVera (nesovera@gmail.com)
 * Released under the MIT License.
 */
var global,factory;global=this,factory=function(){"use strict";var toStr,isCallable,maxSafeInteger,toLength;function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw TypeError("");var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw TypeError("");for(var n=arguments[1],o=0;o<r;){var i=t[o];if(e.call(n,i,o,t))return i;o++}},configurable:!0,writable:!0}),Array.from||(Array.from=(toStr=Object.prototype.toString,isCallable=function(e){return"function"==typeof e||"[object Function]"===toStr.call(e)},maxSafeInteger=Math.pow(2,53)-1,toLength=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),maxSafeInteger)},function(e){var t=this,r=Object(e);if(null==e)throw new TypeError("");var n,o=arguments.length>1?arguments[1]:void 0;if(void 0!==o){if(!isCallable(o))throw new TypeError("");arguments.length>2&&(n=arguments[2])}for(var i,s=toLength(r.length),a=isCallable(t)?Object(new t(s)):new Array(s),l=0;l<s;)i=r[l],a[l]=o?void 0===n?o(i,l):o.call(n,i,l):i,l+=1;return a.length=s,a})),Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),r=t.length,n=new Array(r);r--;)n[r]=[t[r],e[t[r]]];return n});var Colon=function(){function Colon(e){var t=this;if(void 0===e&&(e={}),this.parent=e.parent,this.props=e.props||{},this.scope="function"==typeof e.scope?e.scope():e.scope||{},this.loopScope=e.loopScope||[],this.directives=e.directives||{},this.components=Object.entries(e.components||{}).reduce((function(e,t){var r=t[0],n=t[1];return e[r.toLowerCase()]=n,e}),{}),e.template&&(this.el=e.el||document.createElement("template"),this.el.innerHTML=e.template),this.el=this.el||e.el,!this.el)return console.error("Colon.js root element is not found");e.recursive||(Object.entries(this.scope).forEach((function(e){var r=e[0],n=e[1];"function"==typeof n&&(t.scope[r]=n.bind(t))})),Object.entries(this.directives).forEach((function(e){var r=e[0],n=e[1];t.directives[r]=n.bind(t)}))),["created","beforeUpdate","updated","mounted","destroyed"].map((function(r){t[r]=(e[r]||function(){}).bind(t)})),window.__CJSSTYLE||(window.__CJSSTYLE=this.insertStyle("[__CJSHIDE]{ display:none !important }")),this.created(),this.templateTree=function e(r,n){return"#text"===r.nodeName?r.textContent:{node:r,parent:n,type:r.nodeName.replace(/-/g,"").toLowerCase(),attrs:t.getNodeAttrs(r),children:t.getChildNodes(r).map((function(t){return e(t,r)})),events:[]}}(this.el,null),this.render(),this.mounted()}var _proto=Colon.prototype;return _proto.insertStyle=function(e){return t=document,(r=t.createElement("style")).innerHTML=e,t.head.appendChild(r),r;var t,r},_proto.isObject=function(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e},_proto.getContent=function(e){return"template"===e.nodeName.toLowerCase()&&e.content||e},_proto.getChildNodes=function(e){return Array.from(this.getContent(e).childNodes).filter((function(e){return!/^(SCRIPT|STYLE)$/.test(e.nodeName)}))},_proto.getNodeAttrs=function(e){return Array.from(e.attributes||[]).reduce((function(e,t){return e[t.nodeName]=t.nodeValue,e}),{})},_proto.nodeToArray=function(e){return"template"===e.nodeName.toLowerCase()?this.getChildNodes(e):[e]},_proto.attrExist=function(e,t){return t.filter((function(t){return Object.keys(e).indexOf(t)>=0})).length},_proto.setAttr=function(e,t,r){if("boolean"==typeof r&&!r||void 0===r)return e.removeAttribute(t);e.setAttribute(t,r)},_proto.run=function run($code,_temp){var _ref4=void 0===_temp?{}:_temp,_ref4$$multi=_ref4.$multi,$multi=void 0!==_ref4$$multi&&_ref4$$multi,$arguments=_ref4.$arguments,$event=_ref4.$event,$this=_ref4.$this,$scope=this.scope,$parent=this.parent,$props=this.props,$loopScope=this.loopScope,loopVars=$loopScope.map((function(e,t){var r=e.keyVar,n=e.keyValue,o=e.valVar;return(r?"var "+r+" = "+JSON.stringify(n)+";":"")+"var "+o+" = $loopScope["+t+"].arr.find(function(v){return v[0]==="+JSON.stringify(n)+"})[1];"})).join("");return eval(loopVars+($multi?$code:"("+$code+")"))},_proto.diffArray=function(e,t,r,n){r||(r=[]),n||(n=[]);for(var o=0;o<Math.max(r.length,n.length);o++){var i=this.diffNode(e,t,r[o],n[o]);i&&(n[o]=i)}return n},_proto.diffNode=function(e,t,r,n){var o=this;if(!r&&n)return this.getContent(e).insertBefore(n,t||null);if(r&&!n)return this.getContent(e).removeChild(r),null;if(r.nodeName!=n.nodeName)return this.getContent(e).replaceChild(n,r),n;if(r.nodeType===Node.TEXT_NODE&&n.nodeType===Node.TEXT_NODE)r.nodeValue!==n.nodeValue&&(r.nodeValue=n.nodeValue);else{var i=this.getNodeAttrs(r),s=this.getNodeAttrs(n);Object.keys(_extends({},i,{},s)).map((function(e){return o.diffAttr(r,e,i[e],s[e])})),this.diffArray(r,null,Array.from(r.childNodes),Array.from(n.childNodes))}return r},_proto.diffAttr=function(e,t,r,n){null===r&&(r=e.getAttribute(t)),":"!==t.charAt(0)&&r!==n&&this.setAttr(e,t,n)},_proto.addPlaceHolder=function(e,t){e.cloneNode||(e.placeHolder=this.getContent(e.parent).insertBefore(document.createComment("<"+t+">"),e.node),e.cloneNode=e.node.cloneNode(!0),this.getContent(e.parent).removeChild(e.node),e.children=e.node=null)},_proto.renderTreeNode=function(e){var t=this,r=this,n=e.node,o=e.parent,i=e.type,s=e.attrs,a=e.children;if(!this.attrExist(s,[":pre"]))if(this.components[i]){this.addPlaceHolder(e,i);var l=Object.entries(s).map((function(e){var r=e[0],n=e[1];return":"===r.charAt(0)?[r.slice(1),t.run(n)]:[r,n]})).reduce((function(e,t){var r=t[0],n=t[1];return e[r]=n,e}),{});l.children=e.cloneNode.cloneNode(!0);var c=new Colon(_extends({props:l,parent:this},this.components[i])).el;e.renderedChildren=this.diffArray(o,e.placeHolder,e.renderedChildren,c?this.nodeToArray(c):[])}else Object.entries(s).filter((function(e){var t=e[0];return/^[:@]/.test(t)})).forEach((function(a){var l=a[0],c=a[1];if(!t.attrExist(s,[":for",":if"])||/^:(for|if)$/.test(l)){var d=l.slice(1);if(n&&void 0!==n.getAttribute(l)&&n.removeAttribute(l),/^@/.test(l)){if(e.events.indexOf(d)>=0)return;n.addEventListener(d,(function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];t.run(c,{$multi:!0,$arguments:r,$event:r[0],$this:n}),t.render()}),!1),e.events.push(d)}else if(":for"===l){var f=c.match(/^\s*([^\s,]+)(?:\s*,\s*([^\s,]+))?\s+in\s+(.+)/).slice(1),p=f[0],u=f[1],h=f[2];t.addPlaceHolder(e,":for"),h=t.run(h,{$this:n})||[],Array.isArray(h)&&(h=h.map((function(e,t){return[t,e]}))),t.isObject(h)&&(h=Object.entries(h)),h=h.reduce((function(r,n,o,i){var s=n[0],a=e.cloneNode.cloneNode(!0);return new Colon({el:a,recursive:!0,parent:t.parent,props:t.props,scope:t.scope,directives:t.directives,components:t.components,loopScope:[].concat(t.loopScope,[{arr:i,keyVar:u,keyValue:s,valVar:p}])}),r.push.apply(r,t.nodeToArray(a)),r}),[]),e.renderedChildren=t.diffArray(o,e.placeHolder,e.renderedChildren,h)}else if(":if"===l){var v;t.addPlaceHolder(e,":if"),t.run(c,{$this:n})&&new Colon({el:v=e.cloneNode.cloneNode(!0),recursive:!0,parent:t.parent,props:t.props,scope:t.scope,directives:t.directives,components:t.components,loopScope:t.loopScope}),e.renderedChildren=t.diffArray(o,e.placeHolder,e.renderedChildren,v?t.nodeToArray(v):[])}else if(/^:(class|style)$/.test(l)){var m="class"===d,y=t.run(c,{$this:n})||"";Array.isArray(y)&&(y=y.join(m?" ":";")),t.isObject(y)&&(y=Object.entries(y).reduce((function(e,t){var r=t[0],n=t[1];return e+" "+(m?n?r:"":r+":"+n+";")}),"")),t.diffAttr(n,d,null,((s[d]||"")+(m?" ":";")+(y||"")).trim())}else if(":show"===l){var b=t.run(c,{$this:n});n[b?"removeAttribute":"setAttribute"]("__CJSHIDE",b)}else if("slot"===i&&":name"===l){var g=t.run(c);t.addPlaceHolder(e,"slot:"+g);var A=t.props.children.cloneNode(!0);new Colon({el:A,recursive:!0,parent:t,props:t.props,scope:t.scope,directives:t.directives,components:t.components,loopScope:t.loopScope}),e.renderedChildren=t.diffArray(o,e.placeHolder,e.renderedChildren,Array.from(A.querySelectorAll(g)))}else if(/^:(html|text|json)$/.test(l)){if(!n)return;var C=t.run(c,{$this:n});"json"===d&&(C=JSON.stringify(C,null,2)),null==C&&(C="");var N="html"===d?"innerHTML":"innerText";n[N]!==C&&(n[N]=C)}else if(l){if(Object.entries(t.directives).filter((function(e){var t=e[0],i=e[1];if(new RegExp(t).test(l))return i({$app:r,$attr:l,$value:c,$this:n,$parentNode:o}),!0})).length)return;var $=t.run(c,{$this:n});/^:/.test(d)&&(d=d.slice(1)),t.diffAttr(n,d,null,$)}}})),this.attrExist(s,[":for",":if"])||a.filter((function(e){return"string"!=typeof e})).forEach(this.renderTreeNode.bind(this))},_proto.render=function(){this.beforeUpdate(),this.renderTreeNode(this.templateTree),this.updated()},Colon}();return Colon},"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global=global||self).Colon=factory();