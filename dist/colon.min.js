/*!
 * Colon.js v0.0.6
 * (c) 2018-2019 NesoVera (nesovera@gmail.com)
 * Released under the MIT License.
 */
var global,factory;global=this,factory=function(){"use strict";var toStr,isCallable,maxSafeInteger,toLength;function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw TypeError("");var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw TypeError("");for(var o=arguments[1],n=0;n<r;){var i=t[n];if(e.call(o,i,n,t))return i;n++}},configurable:!0,writable:!0}),Array.from||(Array.from=(toStr=Object.prototype.toString,isCallable=function(e){return"function"==typeof e||"[object Function]"===toStr.call(e)},maxSafeInteger=Math.pow(2,53)-1,toLength=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),maxSafeInteger)},function(e){var t=this,r=Object(e);if(null==e)throw new TypeError("");var o,n=arguments.length>1?arguments[1]:void 0;if(void 0!==n){if(!isCallable(n))throw new TypeError("");arguments.length>2&&(o=arguments[2])}for(var i,a=toLength(r.length),s=isCallable(t)?Object(new t(a)):new Array(a),d=0;d<a;)i=r[d],s[d]=n?void 0===o?n(i,d):n.call(o,i,d):i,d+=1;return s.length=a,s})),Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),r=t.length,o=new Array(r);r--;)o[r]=[t[r],e[t[r]]];return o});var Colon=function(){function Colon(e){var t=this;if(void 0===e&&(e={}),this.root=e.root||this,this.parent=e.parent,this.props=e.props||{},this.data="function"==typeof e.data?e.data():e.data||{},this.methods="function"==typeof e.methods?e.methods():e.methods||{},this.loopScope=e.loopScope||[],this.directives=e.directives||{},this.components=Object.entries(e.components||{}).reduce((function(e,t){var r=t[0],o=t[1];return e[r.toLowerCase()]=o,e}),{}),e.template&&(this.el=e.el||document.createElement("template"),"string"==typeof e.template&&(this.el.innerHTML=e.template),Array.isArray(e.template)&&e.template.forEach((function(e){return t.el.appendChild(e)}))),this.el=this.el||e.el,!this.el)return console.error("Colon root element not found");e.recursive||(Object.entries(this.data).forEach((function(e){var r=e[0],o=e[1];"function"==typeof o&&(t.data[r]=o.bind(t))})),Object.entries(this.methods).forEach((function(e){var r=e[0],o=e[1];"function"==typeof o&&(t.methods[r]=o.bind(t))})),Object.entries(this.directives).forEach((function(e){var r=e[0],o=e[1];t.directives[r]=o.bind(t)}))),["created","beforeUpdate","updated","mounted","destroyed"].map((function(r){t[r]=(e[r]||function(){}).bind(t)})),window.__CJSSTYLE||(window.__CJSSTYLE=this.insertStyle("[__CJSHIDE]{ display:none !important }")),this.created(),this.templateTree=function e(r,o){return"#text"===r.nodeName?r.textContent:{node:r,parent:o,type:r.nodeName.replace(/-/g,"").toLowerCase(),attrs:t.getNodeAttrs(r),children:t.getChildNodes(r).map((function(t){return e(t,r)})),events:[]}}(this.el,null),this.render(),this.mounted()}var _proto=Colon.prototype;return _proto.insertStyle=function(e){return t=document,(r=t.createElement("style")).innerHTML=e,t.head.appendChild(r),r;var t,r},_proto.isObject=function(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e},_proto.getContent=function(e){return"template"===e.nodeName.toLowerCase()&&e.content||e},_proto.getChildNodes=function(e){return Array.from(this.getContent(e).childNodes).filter((function(e){return!/^(SCRIPT|STYLE)$/.test(e.nodeName)}))},_proto.getNodeAttrs=function(e){return Array.from(e.attributes||[]).reduce((function(e,t){return e[t.nodeName]=t.nodeValue,e}),{})},_proto.nodeToArray=function(e){return"template"===e.nodeName.toLowerCase()?this.getChildNodes(e):[e]},_proto.attrExist=function(e,t){return t.filter((function(t){return Object.keys(e).indexOf(t)>=0})).length},_proto.setAttr=function(e,t,r){if("boolean"==typeof r&&!r||void 0===r)return e.removeAttribute(t);e.setAttribute(t,r)},_proto.run=function run($code,_temp){var _ref5=void 0===_temp?{}:_temp,_ref5$$multi=_ref5.$multi,$multi=void 0!==_ref5$$multi&&_ref5$$multi,$arguments=_ref5.$arguments,$event=_ref5.$event,$this=_ref5.$this,$app=this,$data=$app.data,$methods=$app.methods,$root=$app.root,$parent=$app.parent,$props=$app.props,$loopScope=$app.loopScope,loopVars=$loopScope.map((function(e,t){var r=e.keyVar,o=e.keyValue,n=e.valVar;return(r?"var "+r+" = "+JSON.stringify(o)+";":"")+"var "+n+" = $loopScope["+t+"].arr.find(function(v){return v[0]==="+JSON.stringify(o)+"})[1];"})).join("");return eval(loopVars+($multi?$code:"("+$code+")"))},_proto.diffArray=function(e,t,r,o){r||(r=[]),o||(o=[]);for(var n=0;n<Math.max(r.length,o.length);n++){var i=this.diffNode(e,t,r[n],o[n]);i&&(o[n]=i)}return o},_proto.diffNode=function(e,t,r,o){var n=this;if(!r&&o)return this.getContent(e).insertBefore(o,t||null);if(r&&!o)return this.getContent(e).removeChild(r),null;if(r.nodeName!=o.nodeName)return this.getContent(e).replaceChild(o,r),o;if(r.nodeType===Node.TEXT_NODE&&o.nodeType===Node.TEXT_NODE)r.nodeValue!==o.nodeValue&&(r.nodeValue=o.nodeValue);else{var i=this.getNodeAttrs(r),a=this.getNodeAttrs(o);Object.keys(_extends({},i,{},a)).map((function(e){return n.diffAttr(r,e,i[e],a[e])})),this.diffArray(r,null,Array.from(r.childNodes),Array.from(o.childNodes))}return r},_proto.diffAttr=function(e,t,r,o){null===r&&(r=e.getAttribute(t)),r!==o&&this.setAttr(e,t,o)},_proto.addPlaceHolder=function(e,t){e.cloneNode||(e.placeHolder=this.getContent(e.parent).insertBefore(document.createComment("<"+t+">"),e.node),e.cloneNode=e.node.cloneNode(!0),this.getContent(e.parent).removeChild(e.node),e.children=e.node=null)},_proto.renderTreeNode=function(e){var t=this,$app=this,$this=e.node,r=e.parent,o=e.type,n=e.attrs,i=e.children;if(!this.attrExist(n,[":pre"]))if(this.components[o]){this.addPlaceHolder(e,o);var a=Object.entries(n).map((function(e){var r=e[0],o=e[1];return":"===r.charAt(0)?[r.slice(1),t.run(o)]:[r,o]})).reduce((function(e,t){var r=t[0],o=t[1];return e[r]=o,e}),{});if(a.children=e.cloneNode.cloneNode(!0),e.instance)e.instance.render();else{e.instance=new Colon(_extends({props:a,root:this.root,parent:this},this.components[o]));var s=e.instance.el;e.renderedChildren=this.diffArray(r,e.placeHolder,e.renderedChildren,s?this.nodeToArray(s):[])}}else{if("slot"===o){this.addPlaceHolder(e,"slot");var d=this.getChildNodes(this.props.children.cloneNode(!0));return new Colon({template:d,recursive:!0,root:this.root,parent:this,props:this.props,data:this.data,methods:this.methods,directives:this.directives,components:this.components,loopScope:this.loopScope}),void(e.renderedChildren=this.diffArray(r,e.placeHolder,e.renderedChildren,d))}Object.entries(n).filter((function(e){var t=e[0];return/^[:@]/.test(t)})).forEach((function(o){var i=o[0],a=o[1];if(!t.attrExist(n,[":for",":if"])||/^:(for|if)$/.test(i)){var s=i.slice(1);if($this&&void 0!==$this.getAttribute(i)&&$this.removeAttribute(i),/^@/.test(i)){if(e.events.indexOf(s)>=0)return;$this.addEventListener(s,(function(){for(var e=arguments.length,$arguments=new Array(e),r=0;r<e;r++)$arguments[r]=arguments[r];t.run(a,{$multi:!0,$arguments:$arguments,$event:$arguments[0],$this:$this}),t.render()}),!1),e.events.push(s)}else if(":for"===i){var d=a.match(/^\s*([^\s,]+)(?:\s*,\s*([^\s,]+))?\s+in\s+(.+)/).slice(1),l=d[0],c=d[1],f=d[2];t.addPlaceHolder(e,":for"),f=t.run(f,{$this:$this})||[],Array.isArray(f)&&(f=f.map((function(e,t){return[t,e]}))),t.isObject(f)&&(f=Object.entries(f)),f=f.reduce((function(r,o,n,i){var a=o[0],s=e.cloneNode.cloneNode(!0);return new Colon({el:s,recursive:!0,root:t.root,parent:t.parent,props:t.props,data:t.data,methods:t.methods,directives:t.directives,components:t.components,loopScope:[].concat(t.loopScope,[{arr:i,keyVar:c,keyValue:a,valVar:l}])}),r.push.apply(r,t.nodeToArray(s)),r}),[]),e.renderedChildren=t.diffArray(r,e.placeHolder,e.renderedChildren,f)}else if(":if"===i){var p;t.addPlaceHolder(e,":if"),t.run(a,{$this:$this})&&new Colon({el:p=e.cloneNode.cloneNode(!0),recursive:!0,root:t.root,parent:t.parent,props:t.props,data:t.data,methods:t.methods,directives:t.directives,components:t.components,loopScope:t.loopScope}),e.renderedChildren=t.diffArray(r,e.placeHolder,e.renderedChildren,p?t.nodeToArray(p):[])}else if(/^:(class|style)$/.test(i)){var u="class"===s,h=t.run(a,{$this:$this})||"";Array.isArray(h)&&(h=h.join(u?" ":";")),t.isObject(h)&&(h=Object.entries(h).reduce((function(e,t){var r=t[0],o=t[1];return e+" "+(u?o?r:"":r+":"+o+";")}),""));var m=((n[s]||"")+(u?" ":";")+(h||"")).trim();t.diffAttr($this,s,null,m)}else if(":show"===i){var v=t.run(a,{$this:$this});$this[v?"removeAttribute":"setAttribute"]("__CJSHIDE",v)}else if(/^:(html|text|json)$/.test(i)){if(!$this)return;var y=t.run(a,{$this:$this});"json"===s&&(y=JSON.stringify(y,null,2)),null==y&&(y="");var b="html"===s?"innerHTML":"innerText";$this[b]!==y&&($this[b]=y)}else if(i){if(Object.entries(t.directives).filter((function(e){var t=e[0],o=e[1];if(new RegExp(t).test(i))return o({$app:$app,$attr:i,$value:a,$this:$this,$parentNode:r}),!0})).length)return;var g=t.run(a,{$this:$this});t.diffAttr($this,s,null,g)}}})),this.attrExist(n,[":for",":if"])||i.filter((function(e){return"string"!=typeof e})).forEach(this.renderTreeNode.bind(this))}},_proto.render=function(){this.beforeUpdate(),this.renderTreeNode(this.templateTree),this.updated()},Colon}();return Colon},"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global=global||self).Colon=factory();